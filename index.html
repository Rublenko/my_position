<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Карта з меню ЦНАПу</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { margin: 0; height: 100%; font-family: sans-serif; }
    #map { height: 100%; width: 100%; }

    #cnapInfoPanel {
      position: absolute;
      right: 10px;
      top: 10px;
      width: 300px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
    }

    #cnapInfoPanel h3 {
      margin-top: 0;
      font-size: 18px;
    }

    #closeInfoBtn {
      position: absolute;
      top: 8px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 18px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div id="cnapInfoPanel">
    <button id="closeInfoBtn">&times;</button>
    <h3>ЦНАП</h3>
    <div id="cnapDetails">
      <em>Оберіть точку на мапі</em>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    const map = L.map('map').setView([48.38, 31.16], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const infoPanel = document.getElementById('cnapInfoPanel');
    const cnapDetails = document.getElementById('cnapDetails');
    const closeBtn = document.getElementById('closeInfoBtn');
    closeBtn.addEventListener('click', () => infoPanel.style.display = 'none');

    async function loadCnapData() {
      const res = await fetch('https://raw.githubusercontent.com/Rublenko/my_position/main/MAP_WAR.json');
      const data = await res.json();

      data.features.forEach(p => {
        const coords = p.geometry.coordinates;
        const props = p.properties;

        const marker = L.marker([coords[1], coords[0]]).addTo(map)
          .bindTooltip(`<b>${props.name || "Без назви"}</b>`, {
            direction: 'top',
            offset: [0, -10],
            opacity: 0.9,
            permanent: false
          });

        marker.on('click', () => {
          cnapDetails.innerHTML = `
            <b>Назва:</b> ${props.full_name || '—'}<br>
            <b>Тип:</b> ${props.type_origin || '—'}<br>
            <b>Адреса:</b> ${props.adress || '—'}<br>
            <b>Графік:</b> ${props.timetable || '—'}<br>
            <b>Сайт:</b> ${props.web ? `<a href="${props.web}" target="_blank">${props.web}</a>` : '—'}<br>
            <b>Телефон:</b> ${props.tel_consul || '—'}<br>
            <b>Онлайн консультування:</b> ${props.onl_consul || '—'}
          `;
          infoPanel.style.display = 'block';
        });
      });
    }

    loadCnapData();
  </script>
</body>
</html>
